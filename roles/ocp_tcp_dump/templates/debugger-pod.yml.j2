apiVersion: v1
kind: Pod
metadata:
  name: "{{ item.1 }}-{{ ansible_role_name | replace("_", "-") }}-{{ item.0 }}-{{ tower_job_id }}"
  namespace: default
spec:
  containers:
  - command:
    - /bin/bash
    - -c
    - |-
      "{{ lookup('template', 'script.bash.j2') | indent(6, false) }}"
    image: registry.redhat.io/rhel8/support-tools
    name: "{{ item.1 }}-{{ ansible_role_name | replace("_", "-") }}-{{ item.0 }}-{{ tower_job_id }}"
    resources:
      requests:
        memory: "256Mi"
        cpu: "250m"
      limits:
        memory: "512Mi"
        cpu: "500m"
    securityContext:
      privileged: true
      runAsUser: 0
    volumeMounts:
    - mountPath: /host
      name: host
  hostNetwork: true
  hostPID: true
  nodeName: "{{ item.1 }}"
  restartPolicy: Never
  volumes:
  - hostPath:
      path: /
      type: Directory
    name: host

